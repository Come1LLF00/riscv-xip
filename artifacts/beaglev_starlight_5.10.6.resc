
# This script runs OpenSBI, U-Boot and Linux on the BeagleV Starlight platform in Renode

$name?="BeagleV"
set bin $ORIGIN/images/beaglev_starlight/payloads/br_fw_payload.elf
set uboot $ORIGIN/images/beaglev_starlight/u-boot/br_u-boot
set dtb $ORIGIN/images/beaglev_starlight/5.10.6/boot/br_starfive_vic7100_beagle_v.dtb
set linux $ORIGIN/images/beaglev_starlight/5.10.6/br_vmlinux
set emmc  $ORIGIN/images/beaglev_starlight/sdcard/br_sdcard.img

emulation SetSeed 0x1
EnsureTypeIsLoaded "Antmicro.Renode.Peripherals.IRQControllers.PLIC.IPlatformLevelInterruptController"
include $ORIGIN/models/BeagleV_PlatformLevelInterruptController.cs

using sysbus
mach create $name
machine LoadPlatformDescription $ORIGIN/beaglev_starlight.repl
emulation SetGlobalSerialExecution True


showAnalyzer uart3

macro reset
"""
    sysbus LoadELF $bin
    sysbus LoadSymbolsFrom $uboot
    sysbus LoadSymbolsFrom $linux
    sysbus LoadBinary $dtb 0xa0100000
"""
runMacro $reset

echo "Script loaded. Now start with with the 'start' command."
echo ""
